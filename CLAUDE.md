# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Go-based Telegram bot for football/soccer schedule management. The bot provides users with fixtures, standings, alerts for favorite teams, and schedule sharing capabilities. It integrates with the API-Football service and uses MySQL for data persistence.

## Development Commands

### Building and Running
- `go build -v ./...` - Build all packages
- `go run tgbot/bot.go` - Run the main Telegram bot
- `go run trans.go` - Run the translation test utility

### Testing and Quality
- `go test -v ./...` - Run all tests with verbose output
- `go test -v ./tgbot/manager/` - Run specific package tests
- `gofmt -l -d .` - Check Go formatting
- `golangci-lint run` - Run linting (requires golangci-lint v1.54+)

### Environment Setup
Copy `.env.dist` to `.env` and configure:
- `DB_DSN` - MySQL database connection string
- `API_FOOTBALL_KEY` - API-Football service key
- `TELEGRAM_BOT_TOKEN` - Telegram bot token
- `GOOGLE_MAPS_API_KEY` - Google Maps API key

## Architecture

### Core Structure
- **`tgbot/bot.go`** - Main entry point with Telegram bot initialization and message routing
- **`db/db.go`** - Database initialization and GORM setup with MySQL
- **`model/`** - Data models split into `bot/` (user, alerts, shares) and `league/` (fixtures, standings, teams)
- **`tgbot/manager/`** - Business logic managers for different bot features
- **`command/`** - CLI-style commands for data fetching from API-Football
- **`util/`** - Shared utilities (caching, i18n, environment loading, transformers)

### Key Managers
- **`schedule_manager.go`** - Core fixture scheduling and display logic
- **`alert_manager.go`** - Favorite team alerts with configurable timing
- **`image_generator.go`** - Dynamic image generation for standings tables
- **`user_manager.go`** - User preferences and localization
- **`cache_manager.go`** - In-memory caching with Otter library

### Data Flow
1. Bot receives Telegram messages and routes to appropriate managers
2. Managers use command fetchers to retrieve data from API-Football
3. Data is transformed via `util/transformer/` and cached
4. GORM models persist user preferences and alert configurations
5. Responses include inline keyboards generated by `tgbot/template/markups.go`

### Internationalization
- Translation files in `tgbot/translation/{locale}/test.yml`
- Supported locales: English (en), Russian (ru), German (de)
- Initialized via `util.InitTranslator()` with fallback to English

### External Dependencies
- **API-Football Client** (`github.com/syurchen93/api-football-client`) - Third-party wrapper for football data
- **GORM** - ORM with MySQL driver
- **Telegram Bot Library** (`github.com/go-telegram/bot`)
- **Image Generation** (`github.com/fogleman/gg`) - For creating standings images
- **Caching** (`github.com/maypok86/otter`) - High-performance in-memory cache
- **Scheduling** (`atomicgo.dev/schedule`) - Timer-based alert system

### Testing
Tests are located alongside source files (e.g., `schedule_manager_test.go`, `markups_test.go`). The project uses standard Go testing with testify for assertions.